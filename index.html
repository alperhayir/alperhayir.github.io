<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>🚀 Rastgele Bir NASA Gözlemi</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="stars"></div>
  <button class="theme-toggle" onclick="toggleTheme()">🌚 Tema Değiştir</button>
  <h1>🚀 NASA Günün Fotoğrafı</h1>

  <div class="photo-box">
    <p id="date">Yükleniyor...</p>
    <h2 id="title"></h2>
    <img id="image" src="" alt="Günün Fotoğrafı" />
    <p id="description"></p>
    <button id="toggleDescription" style="display:none" onclick="toggleFullText()">…devamını oku</button>
    <br>
    <a id="wikipediaLink" class="link-btn" target="_blank"></a>
    <br>
    <a id="sourceLink" class="link-btn" target="_blank"></a>
  </div>

  <button onclick="getPhoto()">🔄 Yeni Fotoğraf Göster</button>

  <script>
    let fullExplanation = '';
    let shortExplanation = '';
    let isExpanded = false;
    let originalText = '';
    let translatedText = '';

    function toggleTheme() {
      document.body.classList.toggle('light');
    }

    function toggleFullText() {
      isExpanded = !isExpanded;
      const desc = document.getElementById('description');
      const toggleBtn = document.getElementById('toggleDescription');
      desc.innerText = isExpanded ? translatedText : shortExplanation;
      toggleBtn.innerText = isExpanded ? 'Kısalt' : '...devamını oku';
    }

    function getRandomDate() {
      const start = new Date(2015, 0, 1);
      const end = new Date();
      const random = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
      const yyyy = random.getFullYear();
      const mm = String(random.getMonth() + 1).padStart(2, '0');
      const dd = String(random.getDate()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}`;
    }

    async function translateToTurkish(text) {
      const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=tr&dt=t&q=${encodeURIComponent(text)}`);
      const data = await res.json();
      return data[0][0][0];
    }

    async function getPhoto() {
      const date = getRandomDate();
      const res = await fetch(`https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&date=${date}`);
      const data = await res.json();

      document.getElementById('date').innerText = `📅 Tarih: ${data.date}`;
      document.getElementById('title').innerText = `🌌 Başlık: ${data.title}`;
      document.getElementById('image').src = data.url;

      originalText = data.explanation;
      translatedText = await translateToTurkish(originalText);

      shortExplanation = translatedText.length > 300 ? translatedText.slice(0, 300) + '...' : translatedText;
      document.getElementById('description').innerText = shortExplanation;
      document.getElementById('toggleDescription').style.display = translatedText.length > 300 ? 'inline-block' : 'none';

      document.getElementById('wikipediaLink').href = `https://tr.wikipedia.org/wiki/${encodeURIComponent(data.title)}`;
      document.getElementById('wikipediaLink').innerText = '🔍 Bu konu hakkında bilgi al';

      if (data.copyright) {
        document.getElementById('sourceLink').href = data.hdurl || data.url;
        document.getElementById('sourceLink').innerText = `📷 Kaynak: ${data.copyright}`;
      } else {
        document.getElementById('sourceLink').innerText = '';
      }
    }

    window.onload = getPhoto;
  </script>
</body>
</html>
